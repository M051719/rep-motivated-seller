name: Database Tests

# WORKFLOW DISABLED - Manual trigger only until secrets are configured
#
# Required Secrets:
#   - SUPABASE_ACCESS_TOKEN: Your Supabase access token for CLI operations
#   - SUPABASE_PROJECT_REF: Your Supabase project reference ID
#   - SUPABASE_URL: Your Supabase project URL
#   - SUPABASE_ANON_KEY: Your Supabase anonymous/public key
#
# To re-enable automatic runs:
#   1. Add all required secrets in GitHub Settings > Secrets and variables > Actions
#   2. Uncomment the 'push' and 'pull_request' triggers below
#   3. Remove the 'workflow_dispatch' trigger if you don't want manual runs
#
on:
  workflow_dispatch:
  # push:
  #   branches: [ main, develop ]
  # pull_request:
  #   branches: [ main ]

jobs:
  test-database:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Setup Supabase CLI
      uses: supabase/setup-cli@v1
      
    - name: Run Database Tests
      run: |
        supabase link --project-ref ${{ secrets.SUPABASE_PROJECT_REF }}
        supabase db push
        supabase test db
      env:
        SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
        
    - name: Run Function Tests  
      run: npm run test:functions
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}